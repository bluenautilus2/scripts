Joel Alexander [2:05 PM] 
Hey Beth, you guys are working on docker or rabbit implementation this sprint?

Beth Stevens [2:05 PM] 
yes, both

[2:06]  
well not implementation, but working with someone on it

[2:06]  
addison and i just created the queues this morning

[2:06]  
and it’s in docker also

Joel Alexander [2:06 PM] 
So we have remote rabbit instances for each environment?

Beth Stevens [2:07 PM] 
something like that. they were literally created at 11:45 this morning and I am in a meeting right now, as soon as my account is created i will publish the names to the teams (host names and credentials)

Joel Alexander [2:08 PM] 
Oh sick. That would be awesome to start using

Beth Stevens [2:12 PM] 
yes - i’m also giving training today for docker, and that comes with its own mq that you can use if you would like

[2:12]  
(that setup)


----- March 16th -----
Joel Alexander [11:31 AM] 
Hey Beth, do we have to be on the vpn to access the admin webpages for Rabbit? (edited)

Beth Stevens [11:32 AM] 
gosh, no, not that I know

[11:32]  
they are hosted by another company

[11:32]  
wait the ones for Compose, right? Reposado and Anejo?

Joel Alexander [11:33 AM] 
Also, I think in the table at the bottom, the first one should be Admin Webpage Test, not Production

[11:33]  
No the ones at the bottom

Beth Stevens [11:33 AM] 
ok let me look...

[11:35]  
are you having a problem with anejo, reposado, or both?

Beth Stevens [11:36 AM] 
uploaded and commented on this image: anejo.png
1 Comment
this is what it’s supposed to do

Joel Alexander [11:37 AM] 
I get that

[11:37]  
I guess I just can't log in

Beth Stevens [11:39 AM] 
Ok i see now! yes that was totally wrong!

[11:39]  
I fixed it, can you look at confluence again?

[11:39]  
thank you for telling me

Joel Alexander [11:40 AM] 
Cool

[11:40]  
No prob

Joel Alexander [11:46 AM] 
Oh one more thing

[11:47]  
Has anyone decided on a good way to store the server creds besides just sticking them into a .properties file? (edited)

Beth Stevens [12:43 PM] 
that’s my task for this sprint


----- March 17th -----
Joel Alexander [1:30 PM] 
Hey Beth. Are you currently working on storing server creds for rabbit? Right now I'm trying to do the same for connecting to SAP via JCO but I'd like to help with doing the same for Rabbit.

Beth Stevens [1:30 PM] 
yes, that’s my task for this sprint

[1:30]  
(see above)

Joel Alexander [1:31 PM] 
ok nvm

Beth Stevens [1:35 PM] 
let me get through researching the best way to do it. i’m sorry i’m overloaded at the moment. normally we store it in properties files but my Principal wants it to be fancier than that

Joel Alexander [1:40 PM] 
I spoke to Brent about it and he was telling me that things like that are stored in the APS environment config. I was going to either have him do it or teach me how to fish but I'll leave it alone and pick up another story. (edited)

Beth Stevens [1:41 PM] 
oh, i know really well how the configuration for it works

[1:43]  
if you want you can tell your boss that it will be covered for UDS under https://applevac.atlassian.net/browse/SAFE-249

[1:43]  
i’m sorry i’m in a meeting right now


----- March 20th -----
Joel Alexander [12:32 PM] 
Hey Beth, what are the credentials for prod rabbit?

Beth Stevens [1:17 PM] 
https://applevac.atlassian.net/wiki/display/SAFE/MQ+Production+and+Test+Environment+Credentials

[1:18]  
use “ci” and “password"

Joel Alexander [1:27 PM] 
ok

[1:27]  
Also why are there credentials for ci, qa, and staging if they all point to the same instance? (edited)

Beth Stevens [1:28 PM] 
so the traffic doesn’t get misrouted

Joel Alexander [1:29 PM] 
Can you elaborate on what you mean by traffic?

Beth Stevens [1:29 PM] 
so the mq messages don’t get misrouted

Joel Alexander [1:31 PM] 
Shouldn't rabbit messages be routed based on the binding of exchange, [exchange or queue], and routing key?

Beth Stevens [1:31 PM] 
they can and are you are correct sirt

[1:31]  
*sir

Joel Alexander [1:31 PM] 
So I'm confused then... How would they get misrouted if that's the case?

Beth Stevens [1:32 PM] 
are your exchanges and queues named differently for every test environment?

Joel Alexander [1:33 PM] 
Currently they aren't defined because I stopped my progress due to your suggestion of not having .properties files

[1:33]  
But that is an option (edited)

[1:34]  
So are you saying that ci only has access to exchanges and queues defined under the ci user?

Beth Stevens [1:34 PM] 
Addison Beyer, the principal that tells me what to do, said that the alternatives he wanted me to implement will take too much time (after I investigated them) and so Friday afternoon he agreed that we could just put things in the properties files

[1:34]  
are you editing UDS to connect to MQ or SAP?

[1:35]  
 ```So are you saying that ci only has access to exchanges and queues defined under the ci user?```
<—yes

Joel Alexander [1:35 PM] 
Ah now I understand that piece.

[1:36]  
I think that would be useful information for the docs

Beth Stevens [1:36 PM] 
where we keep the queues and exchanges has nothing to do with the work i’m doing, which is just to connect to the hosts. I am only providing UDS servers a way to connect to portal443-6.reposado.kelsey-and-coryn-data-services-llc.composedb.com:21332

[1:36]  
are you editing UDS to connect to MQ or SAP?

[1:36]  
go ahead and add it if you like.

Joel Alexander [1:36 PM] 
Both

Beth Stevens [1:37 PM] 
ok, for UDS, you need to talk to EJ Capetillo. They already have an enumeration system they are going to use for queue names

[1:37]  
for just connecting to the server, that’s my part, as we discussed last week

Joel Alexander [1:37 PM] 
ok

Beth Stevens [1:38 PM] 
i haven’t been able to make progress on it because i keep stopping to help people with docker and mq

[1:38]  
(i’m not actually that great at mq fyi)

Joel Alexander [1:38 PM] 
that's fine. also ci:password don't work for prod

Beth Stevens [1:39 PM] 
it’s not supposed to! i have a chart with the login for prod. it’s “prod” and then no one is allowed to know the password

Joel Alexander [1:39 PM] 
so how do we make sure our stuff works in prod?

Beth Stevens [1:40 PM] 
if your stuff works in Staging it damn well better work in prod. QA and higher-ups will be able to look at it

[1:40]  
if you think you need the password, ask Addison Beyer please

Joel Alexander [1:40 PM] 
I'm fine with testing in staging but with Myron stating that it's not done until it's in prod then we can't actually prove it works without those creds

[1:40]  
ok

Beth Stevens [1:41 PM] 
ok - so - right now no one can connect to MQ and I”m trying to figure out why. do you mind if i look at that and we can talk more later?

[1:41]  
(the compose mq)

Joel Alexander [1:41 PM] 
Yeah that's fine.

Beth Stevens [1:41 PM] 
also you have a local mq configuration you can use for testing

Joel Alexander [1:41 PM] 
yeah I've had that up before we started this PI

Beth Stevens [1:41 PM] 
great

Joel Alexander [1:42 PM] 
Sorry if I'm pestering you, I just like getting all the info I need all at once instead of going back and forth.

[1:42]  
Thanks for your help! :slightly_smiling_face: Let me know if I can test anything for you

Beth Stevens [1:42 PM] 
i’m usually nicer the problem is i have about 5 people all asking similar questions :disappointed:

[1:43]  
actually once we can connect to the mq server, i might ask you to try too

Joel Alexander [1:43 PM] 
That's alright we're all under pressure to perform and get stuff done quickly.

[1:43]  
Ok, I'll be here when you need me

Beth Stevens [2:11 PM] 
ok, I have a support ticket out to the Compose company to see why the accounts might not be working

Beth Stevens [3:43 PM] 
ok, we figured out the problem, and we corrected the configuration page in Confluence

Joel Alexander [3:44 PM] 
Cool! What was the issue?

Beth Stevens [3:44 PM] 
we specified the wrong virtual host at the end of the uri string

Beth Stevens [3:52 PM] 
Addison thought it should be the name of the deployment, but it was supposed to be the name of the virtual host

Joel Alexander [3:53 PM] 
Oh I see


----- March 23rd -----
Joel Alexander [1:43 PM] 
Hey Beth, how do we get the certs from the Rabbit servers so we can connect to them?

Beth Stevens [1:43 PM] 
shouldn’t need certs

[1:43]  
who is saying you do?

Joel Alexander [1:43 PM] 
I'm trying to connect to rabbit with ci creds and I'm getting some errors

Beth Stevens [1:44 PM] 
make sure and set the exchange to “ci"

Joel Alexander [1:44 PM] 
the exchange or the vhost?

Beth Stevens [1:45 PM] 
i’m sorry. you’re right.  the “virtual host"

[1:45]  
in the connection

Joel Alexander [1:45 PM] 
does that also apply to the management url too?

Beth Stevens [1:46 PM] 
if you’re using the URL please copy and paste the one from my document

Joel Alexander [1:46 PM] 
Yeah that's what I'm using

[1:46]  
and I'm getting those errors

Beth Stevens [1:47 PM] 
we have three tests that can connect to CI using those urls...

[1:47]  
can you get someone who knows MQ to come look at your code?

Joel Alexander [1:47 PM] 
Can I see? So I can verify?

Beth Stevens [1:47 PM] 
also, i’m in the middle of writing the code that connects. you don’t have to write that code

[1:47]  
remember

[1:48]  
sure i wrote a python program that can connect:
```#!/usr/bin/env python
import pika

connection = pika.BlockingConnection(pika.URLParameters(
        'amqps://ci:password@portal443-6.reposado.kelsey-and-coryn-data-services-llc.composedb.com:21332/ci'))
channel = connection.channel()

channel.queue_declare(queue='hello')

channel.basic_publish(exchange='',
                      routing_key='hello',
                      body='Hello World!')
print(" [x] Sent 'Hello World!'")
connection.close()```

[1:49]  
ej wrote java that can connect but didn’t check it in

Joel Alexander [1:49 PM] 
Ah that's with the amqps uri. that one sets up the bindings. that one works for me

[1:49]  
it's the other one that doesn't work for me

Beth Stevens [1:49 PM] 
addison wrote a spring based connection that can connect

[1:50]  
well if you can please just wait, i will have the stupid code checked in that can connect.

[1:50]  
remember?

[1:50]  
i am working on it right now

[1:50]  
like right right now

Joel Alexander [1:57 PM] 
is there any way I can help?

Beth Stevens [1:57 PM] 
I just spent 5 minutes explaining to Brent Krum that your error doesn’t make any sense… you can’t set a GET request to an MQ server!

Joel Alexander [1:57 PM] 
Yeah you can

[1:58]  
RabbitMQ has an API

[1:58]  
It's trying to pull a list of queues that I can filter on to know which ones my proxy needs to listen to for messages coming in.

[1:59]  
 ```https://ci:password@portal443-6.reposado.kelsey-and-coryn-data-services-llc.composedb.com:21332/api/exchanges/ci/UDS.Rates/bindings/source```
(edited)

Beth Stevens [2:00 PM] 
my code is here. it does not work.  it will be done as soon as i have time to write it. which i am trying to do right now. git@scm.appleleisuregroup.com:alg/alg-common-mq.git

Joel Alexander [2:09 PM] 
Mind telling me what the error is?

Beth Stevens [2:10 PM] 
i’m still writing the unit tests?

[2:10]  
so…. null pointer exceptino?

Joel Alexander [2:10 PM] 
oh

[2:10]  
sorry

[2:10]  
I'll leave you alone

Beth Stevens [2:10 PM] 
ok. i should be done by COB today

[2:10]  
i’m pushing every hour

Joel Alexander [2:17 PM] 
k.

Beth Stevens [8:18 PM] 
I’m still working on the mq stuff- i had to leave work suddenly. The code is all written now but I’m getting a timeout error (different from your cert error). am trying the URI method next

Beth Stevens [8:24 PM] 
ok the URI works.

[8:24]  
i think that’s what you saw too

[8:28]  
i think the reason that the uri method works and the parametrized connection method don’t work, because the “s” in amqps for the URI

[8:28]  
(working on it)

Beth Stevens [8:37 PM] 
ok yeah that was it- is fixed and connections are working onw

[8:37]  
*now


----- March 24th -----
Joel Alexander [11:09 AM] 
Hi Beth, I see that you finished. How are we importing the project, through importing a jar or as a maven dependency?

Beth Stevens [11:14 AM] 
maven dependency, Brent Krum is adding the new repo to Jenkins so we can use it as a proper maven library. but until he does that, if you want to import it as a jar that will help you

[11:14]  
EJ is going to write code to create the channels for UDS

[11:14]  
right now it’s in Bizops-server, but we’re going to move it to the new libary (alg-common-mq)

Joel Alexander [11:18 AM] 
ok

[11:19]  
We'll still create our bindings in our own services right?

Beth Stevens [11:22 AM] 
yes, I believe so

Joel Alexander [11:22 AM] 
ok

[11:22]  
thanks.

Joel Alexander [11:28 AM] 
Also, sorry for the past couple days, I just wanted to haul ass and get things done.

Beth Stevens [11:28 AM] 
yeah i know its frustrating to wait on others :disappointed:

[11:28]  
i wanted to do this work last sprint but couldn't

Joel Alexander [3:51 PM] 
Hey did Brent tell you when he'd be done?

[3:52]  
I'm having issues using the jar

Beth Stevens [3:52 PM] 
no, but here’s the ticket https://applevac.atlassian.net/browse/ITP-1120

Joel Alexander [3:53 PM] 
oh. ok.


----- Yesterday March 27th, 2017 -----
Joel Alexander [2:06 PM] 
Hey Beth. Is anyone using the rabbit common library?

Beth Stevens [2:06 PM] 
probably not yet, since Brent hasn’t added it to Nexus. EJ might be

Joel Alexander [2:07 PM] 
ok i've been generating a jar and trying to use it and I've been getting stack overflow exceptions

Beth Stevens [2:07 PM] 
Brent moved it to “active” (the ticket)

[2:08]  
on which method, on which class?

Joel Alexander [2:12 PM] 
that's the thing, it doesn't say much but it only occurs when I start calling the validateAndSetup method

[2:13]  
Is the library expecting any file to exist in the {server.config.dir}?

Beth Stevens [2:13 PM] 
yeah, it is

[2:13]  
and the files aren’t there

[2:13]  
you need to put a file there

Joel Alexander [2:13 PM] 
lol I wish I had known that earlier :smile:

Beth Stevens [2:14 PM] 
i’m working on the file right now

[2:14]  
let me make you a temporary one

[2:14]  
do you want to connect to your local mq or compose?

Joel Alexander [2:14 PM] 
local for now

Beth Stevens [2:15 PM] 
are you running it in docker or in your own websphere setup?

Joel Alexander [2:16 PM] 
docker

[2:16]  
Is it just the mq.properties file?

Beth Stevens [2:16 PM] 
yes

[2:20]  
what host, in docker?

[2:20]  
which webservice needs this config?

Joel Alexander [2:21 PM] 
I'm using my own docker not the one set up for the uds apps

Beth Stevens [2:21 PM] 
ok then, you are responsible for creating this config file and adding it to the correct place in your docker image:
```server.1.hostname = rabbitmq
server.1.username = guest
server.1.password = guest
server.1.port = 5672
server.1.virtualhost```
(edited)

Joel Alexander [2:22 PM] 
it's not reading the file from websphere server directory? (edited)

Beth Stevens [2:23 PM] 
Joel…. your docker image should include that place or have a volume pointing to it….?

[2:23]  
if you set up your own docker image for a webserver then you should know where to put its configuration files

Joel Alexander [2:24 PM] 
Right you're not using the uds config stuff...

Beth Stevens [2:24 PM] 
what?

[2:24]  
uds uses properties files

Joel Alexander [2:24 PM] 
Yes.

Beth Stevens [2:24 PM] 
what?

Joel Alexander [2:26 PM] 
Ok. When you use the @ConfigInfo annotation it looks for that file in the server directory that gets created when a new server is established in websphere

[2:26]  
I thought you were using that

Beth Stevens [2:26 PM] 
no i am absolutely not using that

[2:26]  
i didn’t want a dependency from the mq config to the Config package

Joel Alexander [2:27 PM] 
I'm using docker for mq not websphere, my websphere is on my machine

Beth Stevens [2:27 PM] 
then put the file in the working directory for the webserver, with the other properties files

Joel Alexander [2:27 PM] 
that's what I did...

Beth Stevens [2:28 PM] 
what is the exact error youre getting?

Joel Alexander [2:28 PM] 
Still a stackoverflow

Beth Stevens [2:28 PM] 
on what method???

Joel Alexander [2:28 PM] 
It's not even giving me that

[2:29]  
This is what I get
```An exception occurred while starting the application av_sap_proxy_service_war. The exception message was: com.ibm.ws.container.service.metadata.MetaDataException: java.lang.StackOverflowError```

Beth Stevens [2:30 PM] 
ok well then wait while i configure a host to use it

Joel Alexander [2:33 PM] 
ok

Beth Stevens [3:40 PM] 
I’m trying to add it to bizops-service, which needs it, but team fortress just completely refactored bizops-service, so it’s taking me a long time to get it building again

Joel Alexander [3:41 PM] 
Brent has the library up in nexus now and the issue has stopped, at least locally. I haven't tried anything beyond that yet. (edited)

Beth Stevens [3:41 PM] 
if there really is a problem with the mq code, that won’t fix it, but i’ll find out hopefully in the next hour

[3:42]  
ah. ok. I still need to get it added to bizops-service so I will continue

Joel Alexander [3:42 PM] 
ok

Beth Stevens [4:07 PM] 
ok, turns out a guy in the Ukraine broke bizops completely

[4:08]  
i’m going to try adding it to a different service

Beth Stevens [4:28 PM] 
I added it to ARI and am getting circular dependency issues with alg-error package. let me know if that becomes a problem for you

[4:28]  
(am removing the dependency)

Beth Stevens [5:37 PM] 
dependency on alg-error is now removed

Beth Stevens [11:52 PM] 
hey Joel, there was a problem reading in the properties but it’s fixed now. Would you make sure and rebuild alg-common-mq before the next time you run your server? (edited)


----- Today March 28th, 2017 -----
Joel Alexander [1:12 PM] 
Hey does the library rely on alg domain?

Beth Stevens [1:12 PM] 
it does, but i can remove the dependency if it’s causing you problems

[1:13]  
(see why i couldn’t use the alg @config library?  :slightly_smiling_face:   )

[1:13]  
it wasn’t causing issues in ARI or bizops so i left it in

[1:14]  
i think the code that originally used alg domain is gone, so I can just take it out of the pom

Joel Alexander [1:14 PM] 
I see... It was causing an error on our routes, saying that it couldn't find OTAPingRQ

Beth Stevens [1:14 PM] 
ok i’ll take it out. should take just a sec...

Joel Alexander [1:14 PM] 
I was told to just rip out the library and just do it how I was for now

Beth Stevens [1:15 PM] 
no i’ll take it out the right way. will take me ten minutes

Joel Alexander [1:15 PM] 
Rip the rabbit library from our service*

Beth Stevens [1:17 PM] 
i rebuilt and pushed. it now takes encrypted passwords. what system are you connecting to?

[1:18]  
also, Blake is putting the encrypted passwords out in the ARI and Bizops servers right now.

Joel Alexander [1:18 PM] 
I was told that this can no longer interfere with the sprint

[1:18]  
...

Beth Stevens [1:19 PM] 
um… i need to talk to your boss

[1:19]  
whodat?

[1:19]  
looking up Colby’s phone number

Joel Alexander [1:20 PM] 
Blake Fisher

Beth Stevens [1:20 PM] 
kk thx

Joel Alexander [1:23 PM] 
What are you using to read and decrypt the properties file in your service?

Beth Stevens [1:24 PM] 
new code i wrote

Joel Alexander [1:25 PM] 
Ok.

[1:25]  
I told Blake to expect a call from you

Beth Stevens [1:27 PM] 
ok. EJ and i are about to do a test with the encrypted passwords (was working before they were encrypted)

Joel Alexander [1:42 PM] 
ok

[1:43]  
Also there's two connections in ci and above, how are we going to switch between the two if one goes down?

Beth Stevens [1:43 PM] 
my code does that

Joel Alexander [1:43 PM] 
It's not something I'm going to worry about right now but in the future

Beth Stevens [1:43 PM] 
well actually sorry no it doesn’t do that

[1:43]  
so - my code tries one connection. then, if that doesn’t work, it tries the next one. and so on and so forth.

[1:44]  
so, if your code asks for a connection, and my code throws an exception, it means that _all_ the hosts aren’t responding.

[1:44]  
(and that there’s a real problm)

Joel Alexander [1:44 PM] 
So all the library is doing is giving us the connections for us to connect to and set up our bindings?

Beth Stevens [1:45 PM] 
yes. and EJ i believe is checking in the bindings stuff into the mq repo after this

[1:45]  
but yeah. since I had to roll my own config and encryption code, because of the dependencies issues, it took longer than it should have.

[1:46]  
but yeah that’s all it does. I think in the future they’re (team champagne) is going to move their bindings code in there

Joel Alexander [1:46 PM] 
I can handle the bindings stuff myself because I don't think I can wait any longer to get my sprint work done

[1:46]  
oh ok

[1:46]  
gotcha

Beth Stevens [1:47 PM] 
yeah, no, no, i wouldn’t expect you to wait - i think team Champagne is not going to have that ready in time for you

Joel Alexander [1:47 PM] 
ok

[1:47]  
Just let me know when you guys are done testing so I can pull it back in

[1:47]  
If push comes to shove and this doesn't work, what can I do?

Beth Stevens [1:48 PM] 
ok. he needs to test Bizops, which is a huge mess right now thanks to Team Fortress

[1:48]  
i have it working in ARI

Joel Alexander [1:48 PM] 
Can I read the mq.properties file and connect myself?

Beth Stevens [1:48 PM] 
i’m here all afternoon and my only task is to help you and EJ get your stuff working

[1:48]  
ok- so what realm (CI?) is your server running in?

[1:49]  
and what server is it?

Joel Alexander [1:50 PM] 
Well I'll have to pull it back in locally so I know it works

Beth Stevens [1:51 PM] 
yeah, that’s fine

[1:51]  
i just want to know so we can get the mq.properties uploaded to the right server in CI

[1:52]  
And then you have two options for your server. 1) Try to connect to MQ on startup  or 2) do a lazy-init and only connect the first time someone tries to use MQ.   Which do you prefer?

Joel Alexander [1:52 PM] 
We connect on startup

[1:52]  
So are you asking for the URL?

[1:53]  
I'm kinda all over the place right now so I'm not understanding what you're asking

Beth Stevens [1:53 PM] 
no, i’m asking for the name of your server

[1:54]  
ok, so at startup, are you connecting the J2EE way, where you annotate the class, or did you add a context listener to web.xml (or a third way I don’t know about?)

Joel Alexander [1:54 PM] 
We're using the @Startup annotation

Beth Stevens [1:54 PM] 
ok, great

[1:55]  
So, right now, can you go into your pom.xml for *Mystery Server* and modify your dependency:
```<dependency>  <groupId>com.appleleisuregroup</groupId>
    <artifactId>alg-common-mq</artifactId>
    <version>1.1.0-SNAPSHOT</version>
</dependency>```
(edited)

[1:56]  
(update the version)

Joel Alexander [1:56 PM] 
You mean my service?

Beth Stevens [1:56 PM] 
the name of your webserver

[1:56]  
what is it called

Joel Alexander [1:57 PM] 
In the remote environments idk what they called the server names

Beth Stevens [1:58 PM] 
ok, yes, give me the URL you use in Postman

Joel Alexander [1:59 PM] 
uds-ci-app-av-sap-proxy-001.dal09.softlayer

Beth Stevens [1:59 PM] 
ok, perfect

[2:01]  
ok, so,   I promise we’ll get this working. it’s working for ARI so it should work for you

Joel Alexander [2:01 PM] 
So decryption is working?

Beth Stevens [2:01 PM] 
yeah, it’s all working

Joel Alexander [2:01 PM] 
ok

Beth Stevens [2:02 PM] 
so go into the pom.xml for av-sap-proxy and increment that version number so it grabs the latest ja

[2:02]  
jar

Joel Alexander [2:02 PM] 
I did and it can't find it

Beth Stevens [2:02 PM] 
(1.1.0-SNAPSHOT)

[2:02]  
oh, ok

[2:02]  
let me check nexus

[2:06]  
uh oh.  Jenkins isn’t kicking off new builds when the library changes. that’s a problem. let me figure it out.

Joel Alexander [2:06 PM] 
Did you manually kick this one off? (edited)

Beth Stevens [2:08 PM] 
no, i didn’t kick off any of them. let me try forcing it through gitlab

Beth Stevens [2:15 PM] 
ok its built, in another minute or so it should be in nexus.  Try building with maven with the -U flag.   (so,   mvn clean install -u) on your av-sap-proxy build

Beth Stevens [2:20 PM] 
(let me know if you still don’t see it)

Beth Stevens [2:33 PM] 
ok EJ just pulled down the 1.1.0 version so you should be able to too now

Joel Alexander [2:39 PM] 
So the only call I need to worry about is the validateAndSetup?

Beth Stevens [2:42 PM] 
actually you just call getConnection().    i need to make validateAndSetup private

[2:42]  
(did it to get unit tests working and never went back)

[2:43]  
here’s how i tested it in a servlet context listener for ARI
```public class StartupTask implements ServletContextListener{
    @Inject
    MQConnectionBroker mqConnectionBroker;

    private static final Logger log = LoggerFactory.getLogger(StartupTask.class);

    @Override
    public void contextDestroyed(ServletContextEvent arg0) {
        log.info("ServletContextListener destroyed $%");

    }

    //Run this before web application is started
    @Override
    public void contextInitialized(ServletContextEvent arg0) {
        log.info("ServletContextListener started $%");
        try {
            log.info("trying to connect");
            log.info("server dir: " + System.getProperty("server.config.dir", ""));
            mqConnectionBroker.getConnection();
            log.info("after connect");
        }catch(Exception e){
            log.error("it threw an error", e);
        }
    }```
(edited)

[2:44]  
should work very similarly in your @Startup EJB

Joel Alexander [2:45 PM] 
you're not using the connection?

Beth Stevens [2:45 PM] 
no, that was for a test. They didn’t want me to check it in yet. The MQ library logs out that the connection was made successfully

Joel Alexander [2:48 PM] 
Which rabbit library are supposed to use to connect to rabbit?

Beth Stevens [2:52 PM] 
my library, alg-common-mq, uses the RabbitMQ library. this was decided by one of the principles

Joel Alexander [2:52 PM] 
Can you send a link to me? (edited)

Beth Stevens [2:53 PM] 
https://scm.appleleisuregroup.com/alg/alg-common-mq

Joel Alexander [2:54 PM] 
I meant the rabbitmq library

[2:54]  
sorry

Beth Stevens [3:01 PM] 
dude… i’ll help you set up my library but i’m not going to help you re-write the exact same code I just wrote.

Joel Alexander [3:01 PM] 
That's not what I'm asking of you.

[3:02]  
I have to create the bindings between exchanges and queues, what rabbit library is used that will accept the connection class that you provide?

Beth Stevens [3:04 PM] 
oh, I get it. Yeah, so when you include my library, it’s going to bring in the classes for MQ.  They are specified as a maven library (there’s not a link)  
```    <dependency>
            <groupId>com.rabbitmq</groupId>
            <artifactId>amqp-client</artifactId>
            <version>4.1.0</version>
        </dependency>```

[3:04]  
so that’s the library. but don’t include it in your pom file - it will cause an error since alg-common-mq is already importing it

[3:05]  
then the code to create the queues, is that same that you use in any MQ tutorial:  
```import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Consumer;
import com.rabbitmq.client.DefaultConsumer;```

[3:06]  
 ```Channel channel = connection.createChannel();
 channel.queueDeclare(QUEUE_NAME, false, false, false, null);
    String message = "Hello World!";
    channel.basicPublish("", QUEUE_NAME, null, message.getBytes());```

[3:06]  
like so

[3:07]  
is that what you’re asking?

Joel Alexander [3:07 PM] 
Also our passwords have to be at least 16 chars?

[3:07]  
Yes.

Beth Stevens [3:07 PM] 
the passwords to MQ?

[3:08]  
no, they don’t… because the password to the CI realm is still “password"

Joel Alexander [3:08 PM] 
```com.appleleisuregroup.common.messagebus.ReadProperties - : Could not decrypt MQ password: 
javax.crypto.IllegalBlockSizeException: Input length must be multiple of 16 when decrypting with padded cipher```
(edited)

Beth Stevens [3:08 PM] 
yeah what’s in your mq.properties file?

[3:08]  
you need to put an encrypted password in there

Joel Alexander [3:08 PM] 
my password is passw0rd

Beth Stevens [3:09 PM] 
ok, well, that’s not going to fly. You need to connect to either the Docker MQ that we have going, or connect to the real compose instance, or, you need to change your local rabbit MQ that you set up to take the password of “guest"

[3:09]  
cause the passwords are encrypted

Joel Alexander [3:09 PM] 
that's not going to fly for my local setup?

[3:09]  
ok then.

Beth Stevens [3:10 PM] 
if you prefer “password” to “guest” i have that encrypted too

Joel Alexander [3:10 PM] 
I'll just change it to guest I guess

Beth Stevens [3:12 PM] 
ok. if you change it to guest, then put this into your mq.properties file:   +rXixiV2b6U3sqz94Yd1nw==

[3:12]  
that’s the password that decrypts into “guest"

Joel Alexander [3:13 PM] 
so `guest+rXixiV2b6U3sqz94Yd1nw==` (edited)

[3:13]  
oh nvm

Beth Stevens [3:13 PM] 
no….   like
```server.1.password=+rXixiV2b6U3sqz94Yd1nw==```

[3:14]  
does it make sense now

Joel Alexander [3:14 PM] 
2:13]  
oh nvm

[3:14]  
nvm = nevermind

[3:15]  
what do you have as your server creds?

[3:15]  
I'm just going to copy yours instead of wrestling with this

Beth Stevens [3:23 PM] 
sure!  We just got these working for EJ:  
```server.1.hostname=portal443-6.reposado.kelsey-and-coryn-data-services-llc.composedb.com
server.1.username=ci
server.1.password=r49GhJtM9XBA7vV8p1Ff0w==
server.1.port=21332
server.1.virtualhost=ci

server.2.hostname=portal373-7.reposado.kelsey-and-coryn-data-services-llc.composedb.com
server.2.username=ci
server.2.password=r49GhJtM9XBA7vV8p1Ff0w==
server.2.port=21332
server.2.virtualhost=ci```

[3:23]  
it connected and he could set up channels !

[3:24]  
that will connect you to CI

Joel Alexander [3:24 PM] 
what about locally?

[3:24]  
are you connecting to this even locally?

Beth Stevens [3:24 PM] 
yes, I’m connecting to the MQ service that comes up with Docker

[3:24]  
with the UDS docker

[3:24]  
..?

[3:25]  
how can i give you the credentials for a docker container that you set up yourself?

[3:26]  
it’s ok to connect to the compose hosts, we’re just going to remove the bad traffic, if any, that gets on the queues
